/*

PROPRIETARY RIGHTS NOTICE

THIS SOFTWARE PRODUCT IS THE PROPRIETARY PROPERTY OF SRYDEN, 
149 NEW MONTGOMERY ST 4TH FLOOR, SAN FRANCISCO, CA 94105, UNITED STATES ("SRYDEN, INC.").

ALL RIGHT, TITLE, AND INTEREST IN AND TO THIS SOFTWARE PRODUCT AND ANY 
AND ALL COPIES THEREOF, INCLUDING BUT NOT LIMITED TO ALL INTELLECTUAL 
PROPERTY RIGHTS, ARE AND SHALL REMAIN THE EXCLUSIVE PROPERTY OF OWNER.

THIS SOFTWARE PRODUCT IS PROTECTED BY COPYRIGHT LAWS AND INTERNATIONAL 
COPYRIGHT TREATIES, AS WELL AS OTHER INTELLECTUAL PROPERTY LAWS AND 
TREATIES.

UNAUTHORIZED REPRODUCTION, DISPLAY, DISTRIBUTION, OR USE OF THIS SOFTWARE 
PRODUCT OR ANY PORTION THEREOF MAY RESULT IN SEVERE CIVIL AND CRIMINAL 
PENALTIES, AND WILL BE PROSECUTED TO THE MAXIMUM EXTENT POSSIBLE UNDER LAW.

© 2024 SRYDEN, INC. ALL RIGHTS RESERVED.

*/ 

const _0x59e5ac=_0x1a4b;(function(_0x4e05ac,_0x5cd2fe){const _0x4e936c=_0x1a4b,_0x5ee8df=_0x4e05ac();while(!![]){try{const _0x4efaad=parseInt(_0x4e936c(0x111))/0x1+-parseInt(_0x4e936c(0x101))/0x2+parseInt(_0x4e936c(0x16c))/0x3+parseInt(_0x4e936c(0x11a))/0x4*(parseInt(_0x4e936c(0x159))/0x5)+parseInt(_0x4e936c(0x108))/0x6+-parseInt(_0x4e936c(0x11e))/0x7*(-parseInt(_0x4e936c(0x14e))/0x8)+parseInt(_0x4e936c(0x155))/0x9*(-parseInt(_0x4e936c(0x15c))/0xa);if(_0x4efaad===_0x5cd2fe)break;else _0x5ee8df['push'](_0x5ee8df['shift']());}catch(_0x3c07ed){_0x5ee8df['push'](_0x5ee8df['shift']());}}}(_0x5954,0xc483d));const fs=require(_0x59e5ac(0x138)),path=require('path'),axios=require(_0x59e5ac(0x140)),Docker=require('dockerode'),crypto=require(_0x59e5ac(0x12a)),config=require('./config.json'),VOLUMES_DIR=config['volumes_dir']||_0x59e5ac(0x117),STRATEGIES_DIR=path[_0x59e5ac(0xfe)](__dirname,_0x59e5ac(0x118)),FLAGGED_CONTAINERS_FILE=_0x59e5ac(0x16d),SCAN_INTERVAL=0x3*0x3c*0x3e8,PUBLIC_WEBHOOK_URL=config['public_whook'],PRIVATE_WEBHOOK_URL=config[_0x59e5ac(0x151)],PTERODACTYL_API_URL=config['panel']+_0x59e5ac(0x15e),PTERODACTYL_API_KEY=config[_0x59e5ac(0x105)],PTERODACTYL_SESSION_COOKIE='none',docker=new Docker();let flaggedContainers={};fs[_0x59e5ac(0x107)](FLAGGED_CONTAINERS_FILE)&&(flaggedContainers=JSON['parse'](fs[_0x59e5ac(0x153)](FLAGGED_CONTAINERS_FILE,_0x59e5ac(0x150))));async function calculateFileHash(_0x234bc6){return new Promise((_0x58b664,_0x48ab67)=>{const _0x21a47b=_0x1a4b,_0x10fe43=crypto[_0x21a47b(0x16b)](_0x21a47b(0x145)),_0x114044=fs[_0x21a47b(0x122)](_0x234bc6);_0x114044['on'](_0x21a47b(0x13a),_0x48ab67),_0x114044['on'](_0x21a47b(0x115),_0x28eea0=>_0x10fe43[_0x21a47b(0x126)](_0x28eea0)),_0x114044['on'](_0x21a47b(0x141),()=>_0x58b664(_0x10fe43[_0x21a47b(0x12b)](_0x21a47b(0x157))));});}async function getServerIdFromUUID(_0x4a4893){const _0x12f71a=_0x59e5ac;try{const _0x12553c=await axios[_0x12f71a(0x14a)](PTERODACTYL_API_URL+'/servers?per_page=50000',{'headers':{'Accept':'application/json','Content-Type':_0x12f71a(0x12d),'Authorization':_0x12f71a(0x169)+PTERODACTYL_API_KEY,'Cookie':PTERODACTYL_SESSION_COOKIE}}),_0x167eae=_0x12553c[_0x12f71a(0x115)][_0x12f71a(0x115)][_0x12f71a(0x14f)](_0x56c5a6=>_0x56c5a6[_0x12f71a(0x148)][_0x12f71a(0x119)]===_0x4a4893);return _0x167eae?_0x167eae[_0x12f71a(0x148)]['id']:null;}catch(_0x1b9594){return console[_0x12f71a(0x13a)]('Error\x20fetching\x20server\x20data:',_0x1b9594),null;}}async function suspendServer(_0x1a24b0){const _0x28a07e=_0x59e5ac;try{await axios[_0x28a07e(0x106)](PTERODACTYL_API_URL+_0x28a07e(0x10f)+_0x1a24b0+'/suspend',{},{'headers':{'Accept':_0x28a07e(0x12d),'Content-Type':_0x28a07e(0x12d),'Authorization':_0x28a07e(0x169)+PTERODACTYL_API_KEY,'Cookie':PTERODACTYL_SESSION_COOKIE}}),console['log'](_0x28a07e(0x114)+_0x1a24b0+_0x28a07e(0x160));}catch(_0xc95f0f){console['error'](_0x28a07e(0x10b)+_0x1a24b0+':',_0xc95f0f);}}async function sendPublicAlert(_0xfdfd94,_0x1f7f24){const _0x30bb21=_0x59e5ac,_0x50b56c={'title':_0x30bb21(0x16e),'color':0x5046e4,'fields':[{'name':_0x30bb21(0x132),'value':_0x1f7f24||_0x30bb21(0x14b),'inline':![]}],'timestamp':new Date()[_0x30bb21(0x165)](),'footer':_0x30bb21(0x110)},_0x5d19d3={'embeds':[_0x50b56c]};try{await axios[_0x30bb21(0x106)](PUBLIC_WEBHOOK_URL,_0x5d19d3),console[_0x30bb21(0x120)](_0x30bb21(0x172)+_0xfdfd94);}catch(_0x511141){console[_0x30bb21(0x13a)](_0x30bb21(0x158)+_0xfdfd94+':',_0x511141);}}async function sendPrivateAlert(_0x4f624d,_0x5677e1,_0x24730a){const _0x45cacf=_0x59e5ac,_0x1550bb={'title':_0x45cacf(0x13c)+_0x5677e1+']','color':0x5046e4,'fields':[{'name':_0x45cacf(0x12e),'value':_0x4f624d,'inline':!![]},{'name':'Panel\x20Server\x20ID','value':_0x5677e1||'Unknown','inline':!![]},{'name':_0x45cacf(0x164),'value':_0x24730a[_0x45cacf(0xfe)]('\x0a')}],'footer':{'text':_0x45cacf(0x170)},'timestamp':new Date()[_0x45cacf(0x165)]()},_0x5f568e={'embeds':[_0x1550bb]};try{await axios[_0x45cacf(0x106)](PRIVATE_WEBHOOK_URL,_0x5f568e),console[_0x45cacf(0x120)]('Sent\x20private\x20alert\x20for\x20container\x20'+_0x4f624d);}catch(_0x4bb175){console[_0x45cacf(0x13a)](_0x45cacf(0x123)+_0x4f624d+':',_0x4bb175);}}async function loadStrategies(){const _0x2dcc2e=_0x59e5ac,_0x2e7feb=[],_0x42d97e=await fs[_0x2dcc2e(0x10d)](STRATEGIES_DIR);for(const _0x10318d of _0x42d97e){if(_0x10318d[_0x2dcc2e(0x174)](_0x2dcc2e(0x129))){const _0x74757b=path['join'](STRATEGIES_DIR,_0x10318d),_0x5e6d25=await fs[_0x2dcc2e(0x163)](_0x74757b,_0x2dcc2e(0x150)),_0x371932=JSON['parse'](_0x5e6d25);_0x2e7feb[_0x2dcc2e(0x11c)](_0x371932);}}return _0x2e7feb;}async function executeStrategy(_0x4a6467,_0x27e2b8,_0x34f2ba){const _0x222bfb=_0x59e5ac,_0x542ec3=[];for(const _0x54923d of _0x4a6467['checks']){if(!_0x54923d||typeof _0x54923d!==_0x222bfb(0x112)||!_0x54923d[_0x222bfb(0x13f)]){console[_0x222bfb(0x161)](_0x222bfb(0x100)+_0x27e2b8);continue;}let _0x2a00a9=![],_0x7316db=_0x54923d[_0x222bfb(0x136)];switch(_0x54923d['type']){case _0x222bfb(0xff):_0x2a00a9=await fileExistenceCheck(_0x27e2b8,_0x54923d);break;case _0x222bfb(0x13e):_0x2a00a9=await fileContentCheck(_0x27e2b8,_0x54923d);break;case'file_size':_0x2a00a9=await fileSizeCheck(_0x27e2b8,_0x54923d);break;case _0x222bfb(0x137):_0x2a00a9=await dependencyCheck(_0x27e2b8,_0x54923d);break;case _0x222bfb(0x14d):_0x2a00a9=await logContentCheck(_0x34f2ba,_0x54923d);break;case _0x222bfb(0x12c):_0x2a00a9=await processCheck(_0x34f2ba,_0x54923d);break;case'network_usage':_0x2a00a9=await networkUsageCheck(_0x34f2ba,_0x54923d);break;default:console['warn'](_0x222bfb(0x12f)+_0x54923d[_0x222bfb(0x13f)]);continue;}_0x2a00a9&&(_0x7316db=_0x7316db[_0x222bfb(0x11f)]('{pattern}',_0x2a00a9[_0x222bfb(0x156)]||'')[_0x222bfb(0x11f)]('{filename}',_0x2a00a9[_0x222bfb(0x139)]||'')[_0x222bfb(0x11f)]('{dependency}',_0x2a00a9[_0x222bfb(0x137)]||'')[_0x222bfb(0x11f)]('{usage}',_0x2a00a9[_0x222bfb(0x116)]?(_0x2a00a9[_0x222bfb(0x116)]/0x400/0x400)[_0x222bfb(0x143)](0x2):'')[_0x222bfb(0x11f)]('{processes}',_0x2a00a9[_0x222bfb(0x152)]?_0x2a00a9[_0x222bfb(0x152)]['join'](',\x20'):''),_0x542ec3[_0x222bfb(0x11c)](_0x7316db));}return _0x542ec3;}async function fileExistenceCheck(_0x4e83f6,_0x4e71d3){const _0x821514=_0x59e5ac;if(!_0x4e71d3[_0x821514(0x103)])return console[_0x821514(0x161)](_0x821514(0x146)+_0x4e83f6),![];const _0x329133=path[_0x821514(0xfe)](_0x4e83f6,_0x4e71d3['path']);if(_0x4e71d3[_0x821514(0x15d)]){for(const _0x27d2f5 of _0x4e71d3[_0x821514(0x15d)]){const _0x1d89f8=await glob(path[_0x821514(0xfe)](_0x329133,_0x27d2f5));if(_0x1d89f8[_0x821514(0x14c)]>0x0)return{'filename':path[_0x821514(0x124)](_0x1d89f8[0x0])};}return![];}else return fs['existsSync'](_0x329133);}async function fileContentCheck(_0x57dfdd,_0x866f0d){const _0x323b47=_0x59e5ac;if(!_0x866f0d[_0x323b47(0x103)]||!_0x866f0d[_0x323b47(0x15d)])return console[_0x323b47(0x161)](_0x323b47(0x10c)+_0x57dfdd),![];const _0x1b2eaf=path[_0x323b47(0xfe)](_0x57dfdd,_0x866f0d['path']);if(fs[_0x323b47(0x107)](_0x1b2eaf)){const _0x343ed1=await fs['readFile'](_0x1b2eaf,_0x323b47(0x150));for(const _0x3f8baa of _0x866f0d[_0x323b47(0x15d)]){if(_0x343ed1[_0x323b47(0x168)](_0x3f8baa))return{'pattern':_0x3f8baa};}}return![];}function _0x5954(){const _0x487575=['createHash','342669ZOelIK','flagged.json','Suspicious\x20activity\x20detected\x20by\x20Radar.','stringify','©\x20SRYDEN,\x20Inc.','size','Sent\x20public\x20alert\x20for\x20container\x20','parse','endsWith','toLowerCase','join','file_existence','Invalid\x20check\x20configuration\x20in\x20strategy\x20for\x20volume\x20','1847842UIzNWH','Invalid\x20check\x20configuration:\x20threshold\x20is\x20undefined\x20for\x20container\x20','path','exec','key','post','existsSync','7683768SGQgyP','max_size','Invalid\x20check\x20configuration:\x20path\x20or\x20max_size\x20is\x20undefined\x20for\x20volume\x20','Error\x20suspending\x20server\x20','Invalid\x20check\x20configuration:\x20path\x20or\x20patterns\x20is\x20undefined\x20for\x20volume\x20','readdir','\x20already\x20flagged.\x20Skipping...','/servers/','Powered\x20by\x20https://radar.sryden.com','865509KsplPh','object','Error\x20checking\x20container\x20logs:','Server\x20','data','usage','/var/lib/pterodactyl/volumes','strategies','uuid','56PZazfS','start','push','Error\x20in\x20anti-abuse\x20script:','63lGALFy','replace','log','cpu_threshold','createReadStream','Error\x20sending\x20private\x20alert\x20for\x20container\x20','basename','logs','update','reduce','\x20seconds\x20before\x20next\x20scan...','.radar','crypto','digest','process_check','application/json','Docker\x20UUID','Unknown\x20check\x20type:\x20','Container\x20','command','Container','networks','Error\x20checking\x20container\x20processes:','filter','message','dependency','fs-extra','filename','error','values','Incident\x20[','Error\x20in\x20scan\x20cycle:','file_content','type','axios','end','tx_bytes','toFixed','Starting\x20continuous\x20container\x20abuse\x20detection...','sha256','Invalid\x20check\x20configuration:\x20path\x20is\x20undefined\x20for\x20volume\x20','split','attributes','Invalid\x20check\x20configuration:\x20command\x20or\x20cpu_threshold\x20is\x20undefined\x20for\x20container\x20','get','Unknown','length','log_content','150632JDhQEx','find','utf-8','private_whook','processes','readFileSync','threshold','1326771DWhxEj','pattern','hex','Error\x20sending\x20public\x20alert\x20for\x20container\x20','12900NKxtkZ','Error\x20checking\x20container\x20network\x20usage:','toString','50lXFGaY','patterns','/api/application','file','\x20suspended\x20successfully.','warn','Completed\x20scan.\x20Waiting\x20','readFile','All\x20Flags','toISOString','stats','writeFile','includes','Bearer\x20','stat'];_0x5954=function(){return _0x487575;};return _0x5954();}async function fileSizeCheck(_0x5b7ec1,_0x2e2393){const _0x3f0219=_0x59e5ac;if(!_0x2e2393[_0x3f0219(0x103)]||!_0x2e2393[_0x3f0219(0x109)])return console[_0x3f0219(0x161)](_0x3f0219(0x10a)+_0x5b7ec1),![];const _0x2c64e2=path['join'](_0x5b7ec1,_0x2e2393['path']);if(fs[_0x3f0219(0x107)](_0x2c64e2)){const _0x105775=await fs[_0x3f0219(0x16a)](_0x2c64e2);return _0x105775[_0x3f0219(0x171)]<_0x2e2393[_0x3f0219(0x109)];}return![];}function _0x1a4b(_0x334ad2,_0x1fce0b){const _0x59541d=_0x5954();return _0x1a4b=function(_0x1a4b27,_0x444370){_0x1a4b27=_0x1a4b27-0xfd;let _0x521a46=_0x59541d[_0x1a4b27];return _0x521a46;},_0x1a4b(_0x334ad2,_0x1fce0b);}async function dependencyCheck(_0x31072d,_0x475607){const _0xb6a36=_0x59e5ac;if(!_0x475607[_0xb6a36(0x15f)]||!_0x475607[_0xb6a36(0x15d)])return console[_0xb6a36(0x161)]('Invalid\x20check\x20configuration:\x20file\x20or\x20patterns\x20is\x20undefined\x20for\x20volume\x20'+_0x31072d),![];const _0x1bc225=path['join'](_0x31072d,_0x475607[_0xb6a36(0x15f)]);if(fs[_0xb6a36(0x107)](_0x1bc225)){const _0x338bc7=JSON[_0xb6a36(0x173)](await fs['readFile'](_0x1bc225,'utf-8')),_0x321b41={..._0x338bc7['dependencies'],..._0x338bc7['devDependencies']};for(const _0x2049dc of _0x475607[_0xb6a36(0x15d)]){const _0x234051=Object['keys'](_0x321b41)[_0xb6a36(0x14f)](_0x404161=>_0x404161[_0xb6a36(0xfd)]()[_0xb6a36(0x168)](_0x2049dc[_0xb6a36(0xfd)]()));if(_0x234051)return{'dependency':_0x234051};}}return![];}async function logContentCheck(_0x9016f7,_0x1feb9b){const _0x566608=_0x59e5ac;if(!_0x1feb9b[_0x566608(0x15d)])return console[_0x566608(0x161)]('Invalid\x20check\x20configuration:\x20patterns\x20is\x20undefined\x20for\x20container\x20'+_0x9016f7['id']),![];try{const _0x10eb53=await _0x9016f7[_0x566608(0x125)]({'stdout':!![],'stderr':!![],'tail':0x3e8}),_0x13bcf1=_0x10eb53[_0x566608(0x15b)]('utf-8');for(const _0x3d830c of _0x1feb9b['patterns']){if(_0x13bcf1[_0x566608(0xfd)]()[_0x566608(0x168)](_0x3d830c[_0x566608(0xfd)]()))return{'pattern':_0x3d830c};}}catch(_0x3933ae){console[_0x566608(0x13a)](_0x566608(0x113),_0x3933ae);}return![];}async function processCheck(_0x2c2e4c,_0x4bcb71){const _0x1898f2=_0x59e5ac;if(!_0x4bcb71[_0x1898f2(0x131)]||!_0x4bcb71[_0x1898f2(0x121)])return console[_0x1898f2(0x161)](_0x1898f2(0x149)+_0x2c2e4c['id']),![];try{const _0x5a9f10=await _0x2c2e4c[_0x1898f2(0x104)]({'Cmd':['sh','-c',_0x4bcb71[_0x1898f2(0x131)]],'AttachStdout':!![],'AttachStderr':!![]}),_0x420b84=await _0x5a9f10[_0x1898f2(0x11b)](),_0x23ee55=await new Promise(_0x5b91e8=>{const _0x19c170=_0x1898f2;let _0x3dccaf='';_0x420b84['on'](_0x19c170(0x115),_0x5c9c33=>_0x3dccaf+=_0x5c9c33[_0x19c170(0x15b)]()),_0x420b84['on'](_0x19c170(0x141),()=>_0x5b91e8(_0x3dccaf));}),_0x3f8184=_0x23ee55['split']('\x0a')[_0x1898f2(0x135)](_0x3267a4=>{const _0x151deb=_0x1898f2,_0x2f2d9a=_0x3267a4['trim']()[_0x151deb(0x147)](/\s+/);if(_0x2f2d9a[_0x151deb(0x14c)]>0x8){const _0x4a571d=parseFloat(_0x2f2d9a[0x8]);return!isNaN(_0x4a571d)&&_0x4a571d>_0x4bcb71['cpu_threshold'];}return![];});return _0x3f8184['length']>0x0?{'processes':_0x3f8184}:![];}catch(_0x5dfce6){return console[_0x1898f2(0x13a)](_0x1898f2(0x134),_0x5dfce6),![];}}async function networkUsageCheck(_0x39e419,_0x139c9f){const _0x35e4a6=_0x59e5ac;if(!_0x139c9f['threshold'])return console[_0x35e4a6(0x161)](_0x35e4a6(0x102)+_0x39e419['id']),![];try{const _0x1f82a3=await _0x39e419[_0x35e4a6(0x166)]({'stream':![]}),_0x1882ea=_0x1f82a3[_0x35e4a6(0x133)]&&Object[_0x35e4a6(0x13b)](_0x1f82a3['networks'])[_0x35e4a6(0x127)]((_0x2bce2e,_0x1467d6)=>_0x2bce2e+_0x1467d6['rx_bytes']+_0x1467d6[_0x35e4a6(0x142)],0x0);return _0x1882ea>_0x139c9f[_0x35e4a6(0x154)]?{'usage':_0x1882ea}:![];}catch(_0xad193f){return console[_0x35e4a6(0x13a)](_0x35e4a6(0x15a),_0xad193f),![];}}async function checkVolume(_0x2aae8b,_0x14ff16){const _0xba056=_0x59e5ac,_0x2e1bb1=path[_0xba056(0xfe)](VOLUMES_DIR,_0x2aae8b),_0x16493d=[];if(!fs[_0xba056(0x107)](_0x2e1bb1))return console[_0xba056(0x120)]('Volume\x20directory\x20for\x20'+_0x2aae8b+'\x20does\x20not\x20exist.\x20Skipping...'),_0x16493d;const _0x38d1c3=docker['getContainer'](_0x2aae8b);for(const _0x10fbde of _0x14ff16){const _0x100057=await executeStrategy(_0x10fbde,_0x2e1bb1,_0x38d1c3);_0x16493d[_0xba056(0x11c)](..._0x100057);}return _0x16493d;}async function scanAllContainers(_0x3f9ae6){const _0x11a601=_0x59e5ac,_0x389e97=await fs[_0x11a601(0x10d)](VOLUMES_DIR);for(const _0x2e08a4 of _0x389e97){if(flaggedContainers[_0x2e08a4]){console[_0x11a601(0x120)](_0x11a601(0x130)+_0x2e08a4+_0x11a601(0x10e));continue;}try{const _0x42a490=await checkVolume(_0x2e08a4,_0x3f9ae6);if(_0x42a490['length']>0x0){const _0x14fd70=await getServerIdFromUUID(_0x2e08a4);_0x14fd70&&await suspendServer(_0x14fd70),await sendPublicAlert(_0x2e08a4,_0x14fd70),await sendPrivateAlert(_0x2e08a4,_0x14fd70,_0x42a490),flaggedContainers[_0x2e08a4]=!![],await fs[_0x11a601(0x167)](FLAGGED_CONTAINERS_FILE,JSON[_0x11a601(0x16f)](flaggedContainers));}}catch(_0x13e1d2){console[_0x11a601(0x13a)]('Error\x20processing\x20volume\x20'+_0x2e08a4+':',_0x13e1d2);}}}async function main(){const _0x5985c4=_0x59e5ac;console[_0x5985c4(0x120)](_0x5985c4(0x144));const _0x52aab3=await loadStrategies();while(!![]){try{await scanAllContainers(_0x52aab3),console[_0x5985c4(0x120)](_0x5985c4(0x162)+SCAN_INTERVAL/0x3e8+_0x5985c4(0x128));}catch(_0x5b5880){console[_0x5985c4(0x13a)](_0x5985c4(0x13d),_0x5b5880);}finally{await new Promise(_0x54b014=>setTimeout(_0x54b014,SCAN_INTERVAL));}}}main()['catch'](_0x391d31=>console['error'](_0x59e5ac(0x11d),_0x391d31));
